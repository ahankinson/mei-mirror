<?xml version="1.0" encoding="UTF-8"?>
<!--
  Â© 2010 by the Music Encoding Initiative (MEI) Council.
  Licensed under the Creative Commons Attribution-NoDerivs Unported License, 
  Version 3.0 (the "License"); you may not use this file except in compliance with the License.
  You may obtain a copy of the License at http://creativecommons.org/licenses/by-nd/3.0/.
-->

<div xmlns="http://www.tei-c.org/ns/1.0" type="div1" xml:id="critapp" n="0">
  <head>Critical Apparatus</head>
  <p>This chapter describes how to encode differences between multiple musical texts of the same musical
    work. These texts are called <soCalled>sources</soCalled> in MEI. The mechanisms and elements 
    described in this chapter are closely related to their counterparts in the corresponding 
    <ref target="http://tei-c.org/TODO">chapter</ref> of the TEI guidelines. 
    It is also important to know about the <ptr target="#editTrans"/> chapter of these guidelines, especially
    the <gi>choice</gi>-element described therein.</p>
  <div type="div2" xml:id="critAppElements">
    <head>General usage of the critApp Module</head>
    <p>
      The following elements are defined in the critApp Module:
      <specList>
        <specDesc key="app"/>
        <specDesc key="lem"/>
        <specDesc key="rdg"/>
      </specList>
      An <gi>app</gi>-element always encapsulates the differences between varying sources. Therefore it has 
      to contain at least two child elements. Possible child elements are <gi>lem</gi> and <gi>rdg</gi>, which 
      use the same model in MEI, but have a different meaning: Whereas <gi>lem</gi> is used for prioritizing one 
      alternative, a <gi>rdg</gi> has no such additional meaning and just holds a reading as found in one or 
      more sources. Accordingly, <gi>lem</gi> is allowed only once in <gi>app</gi>, whereas <gi>rdg</gi> may
      appear as often as necessary. 
      <egXML xmlns="http://www.tei-c.org/ns/Examples">
        <app>
          <lem>
            <!-- preferred reading -->
          </lem>
          <rdg>
            <!-- alternative reading -->
          </rdg>
          <rdg>
            <!-- alternative reading -->
          </rdg>
        </app>
      </egXML>
    </p>
    <p>
      The order of <gi>rdg</gi> elements is not important. Instead, <gi>rdg</gi> (and <gi>lem</gi>) use the 
      <att>source</att> attribute to point to one or more <gi>source</gi> elements in the document's header:
      <egXML xmlns="http://www.tei-c.org/ns/Examples">
        <!-- In the document content: -->
        <app>
          <rdg source="#source1">
            <!-- reading of source 1 -->
          </rdg>
          <rdg source="#source2 #source3">
            <!-- reading of sources 2 and 3 -->
          </rdg>
        </app>
        
        <!-- In the document header: -->
        <sourceDesc>
          <source xml:id="source1"/>
          <source xml:id="source2"/>
          <source xml:id="source3"/>
        </sourceDesc>
      </egXML>
    </p>
    <p>
      If one source has additional content that the other(s) don't have, this may be indicated by an empty <gi>rdg</gi>:
      <egXML xmlns="http://www.tei-c.org/ns/Examples">
        <app>
          <rdg source="#source1">
            <!-- additional content of source 1 -->
          </rdg>
          <rdg source="#source2 #source3"/>
        </app>
      </egXML>
    </p>
    <p>
      When working with a large number of sources, it might seem rather lengthy to provide references for all sources.
      However, it is not recommended to use a <gi>rdg</gi> element without <att>source</att> as "fallback" for all
      sources unassigned otherwise, as such an encoding is somewhat unclear and less explicit.
    </p>
  </div>
  <div type="div2" xml:id="critappInContent">
    <head>Using <gi>app</gi> in musical content</head>
    <p>
      The <gi>app</gi> element may be used in very different positions of an MEI file. This has certain side effects
      <note place="bottom">It is up to the encoder to ensure that the <gi>app</gi> and <gi>rdg</gi> / <gi>lem</gi>
      are used correctly, that is the content of every <gi>rdg</gi> and <gi>lem</gi> has to be a valid replacement
      of its parent <gi>app</gi>.</note> and makes it one of the most versatile elements in MEI. It may be used to
      indicate minor differences like stem directions:
      <egXML xmlns="http://www.tei-c.org/ns/Examples">
        <layer>
          <!-- preceding notes -->
          <app>
            <rdg source="#source1">
              <note pname="b" oct="4" dur="2" stem.dir="down"/>
            </rdg>
            <rdg source="#source2">
              <note pname="b" oct="4" dur="2" stem.dir="up"/>
            </rdg>
          </app>
          <!-- following notes -->
        </layer>
      </egXML>
      or bigger differences like additional measures: 
      <egXML xmlns="http://www.tei-c.org/ns/Examples">
        <section>
          <measure/>
          <measure/>
          <app>
            <rdg source="#source1"/>
            <rdg source="#source2">
              <measure/>
              <measure/>
            </rdg>
          </app>
          <measure/>  
        </section>
      </egXML>
    </p>
    <!-- Here we might add several other examples -->
  </div>
  <div type="div2" xml:id="critappInDefs">
    <head>Using <gi>app</gi> for Score Definitions</head>
    <p>
      Besides using it to differentiate the musical content of multiple sources itself, <gi>app</gi> may 
      also be applied to describe different score setups, even when the musical content itself stays untouched.
      An example for this might be a source that changes staff order. By definition, the order of staves is derived
      from the order of <gi>staffDef</gi> elements in <gi>scoreDef</gi>, not from the order of <gi>staff</gi> elements
      within <gi>measure</gi>. Instead, <gi>staff</gi> allows to point to its corresponding <gi>staffDef</gi> either 
      using the same value for <att>n</att> on both elements or providing an explicit reference with <gi>staff</gi>s
      <att>def</att> pointing to a <gi>staffDef</gi>s <att>xml:id</att>. 
    </p>
    <p>
      When using the first (more vague) of these two approaches, it is possible to point dynamically to the correct 
      <gi>scoreDef</gi> / <gi>staffDef</gi> for a given source. The following example demonstrates an alternate
      order of a two-stave score within two sources:
      <egXML xmlns="http://www.tei-c.org/ns/Examples">
        <app>
          <rdg source="#source1">
            <scoreDef>
              <staffGrp>
                <staffDef n="1"/>
                <staffDef n="2"/>
              </staffGrp>
            </scoreDef>
          </rdg>
          <rdg source="#source2">
            <scoreDef>
              <staffGrp>
                <!-- The order of <staffDef> elements defines score order, not it's @n attribute! -->
                <staffDef n="2"/>
                <staffDef n="1"/>
              </staffGrp>
            </scoreDef>
          </rdg>
        </app>
        <section>
          <measure>
            <staff n="1"/>
            <staff n="2"/>
          </measure>
        </section>
      </egXML>
    </p>
    <p>
      In the example above, no further <gi>app</gi> would be necessary within the individual <gi>measure</gi>s
      to describe the alternating score order of the sources. 
    </p>
    <p>
      This mechanism may also be used to describe differing page orientations, formats and margins, but also
      clefs and keys. Unless using unique values for <att>n</att> on <gi>layer</gi> and <gi>layerDef</gi> respectively,
      it is not possible to reallocate layers to staves as easily, though.
    </p>
    
  </div>
  <div type="div2" xml:id="critAppNesting">
    <head>Nesting apparati</head>
    <p>
      In some situations, musical sources principally do agree on larger sections, but differ on some aspects of them. 
      For these cases, <gi>app</gi> elements may be nested at any level. 
      <egXML xmlns="http://www.tei-c.org/ns/Examples">
        <measure/>
        <app>
          <rdg source="#source1"/>
          <rdg source="#source2 #source3">
            <!-- whereas source1 misses it, source2 and source3 share an additional measure -->
            <measure>
              <staff>
                <layer>
                  <app>
                    <!-- while source2 reads a measure rest, source3 reads a whole note -->
                    <rdg source="#source2">
                      <mRest/>
                    </rdg>
                    <rdg source="#source3">
                      <note pname="g" oct="3" dur="1"/>
                    </rdg>
                  </app>
                </layer>
              </staff>
            </measure>
          </rdg>
        </app>
        <measure/>
      </egXML>
    </p>
    <p>
      When nesting <gi>app</gi> elements, it is important that the pointers in the child <gi>rdg</gi>'s 
      <att>source</att> attribute must be a strict subset of the ancestor <gi>rdg</gi>'s <att>source</att>,
      that is, no other source may be "reintroduced" in a <gi>rdg</gi>'s subtree by nesting another <gi>rdg</gi>.
    </p>
  </div>  
  <!--<div type="div2" xml:id="critAppOverview">
    <!-\- Overview -\->
    <head>Overview of the critApp Module</head>
    <p>The module described in this chapter makes available the following components:</p>
    <div type="div3" xml:id="critAppElements">
      <head>Elements</head>
      <p>
        <specList>
          <specDesc key="app"/>
          <specDesc key="lem"/>
          <specDesc key="rdg"/>
        </specList>
      </p>
    </div>
    <div type="div3" xml:id="critAppAttributeClasses">
      <head>Attribute Classes</head>
      <p>
        <specList>
          <specDesc key="att.crit"/>
          <specDesc key="att.rdg.anl"/>
          <specDesc key="att.rdg.ges"/>
          <specDesc key="att.rdg.log"/>
          <specDesc key="att.rdg.vis"/>
          <specDesc key="att.source"/>
        </specList>
      </p>
    </div>
    <div type="div3" xml:id="critAppModelClasses">
      <head>Model Classes</head>
      <p>
        <specList>
          <specDesc key="model.appLike"/>
          <specDesc key="model.rdgPart.critapp"/>
        </specList>
      </p>
    </div>
  </div>-->
  
</div>
